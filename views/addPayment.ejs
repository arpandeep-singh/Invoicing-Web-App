<!--
=========================================================
* Argon Dashboard - v1.2.0
=========================================================
* Product Page: https://www.creative-tim.com/product/argon-dashboard

* Copyright  Creative Tim (http://www.creative-tim.com)
* Coded by www.creative-tim.com

=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
        <meta name="author" content="Creative Tim">
        <title>KS Builders</title>
        <!-- Favicon -->
        <link rel="icon" href="../assets/img/brand/favicon.png" type="image/png">
        <!-- Fonts -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
        <!-- Icons -->
        <link rel="stylesheet" href="../assets/vendor/nucleo/css/nucleo.css" type="text/css">
        <link rel="stylesheet" href="../assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
        <!-- Argon CSS -->
        <link rel="stylesheet" href="../assets/css/argon.css?v=1.2.0" type="text/css">
      </head>

<body>
  <!-- Sidenav -->
  <%- include ('partials/navbar.ejs') %>
  <!-- Main content -->
  <div class="main-content" id="panel">
    <!-- Topnav -->
    <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- Search form -->
         
          <!-- Navbar links -->
          <ul class="navbar-nav align-items-center  ml-md-auto ">
            <li class="nav-item d-xl-none">
              <!-- Sidenav toggler -->
              <div class="pr-3 sidenav-toggler sidenav-toggler-dark" data-action="sidenav-pin"
                data-target="#sidenav-main">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                </div>
              </div>
            </li>



          </ul>
          <ul class="navbar-nav align-items-center  ml-auto ml-md-0 ">
            <li class="nav-item dropdown">
              <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                <div class="media align-items-center">

                  <div class="media-body  ml-2  d-none d-lg-block">
                    <span class="mb-0 text-sm  font-weight-bold">Admin@ksbuilders</span>
                  </div>
                </div>
              </a>
              <div class="dropdown-menu  dropdown-menu-right ">
                <div class="dropdown-header noti-title">
                  <h6 class="text-overflow m-0">Welcome!</h6>
                </div>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-single-02"></i>
                  <span>My profile</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-settings-gear-65"></i>
                  <span>Settings</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-calendar-grid-58"></i>
                  <span>Activity</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-support-16"></i>
                  <span>Support</span>
                </a>
                <div class="dropdown-divider"></div>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-user-run"></i>
                  <span>Logout</span>
                </a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Header -->
    <!-- Header -->
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row align-items-center py-4">
            <div class="col-lg-6 col-7">
              <h6 class="h2 text-white d-inline-block mb-0">Default</h6>
              <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                  <li class="breadcrumb-item"><a href="/dashboard"><i class="fas fa-home"></i></a></li>
                  <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Quotation</li>
                </ol>
              </nav>
            </div>

          </div>
          <!-- Card stats -->

        </div>
      </div>
    </div>
    <!-- Page content -->
    <div class="container-fluid mt--6">
      <div class="row">
        <div class="col-xl-8">
          <div class="card">
            <div class="card-header">
              <div class="row align-items-center">
                <div class="col-8">
                  <h3 class="mb-0">Add Quotation </h3>
                </div>

               


              </div>
            </div>
            <div class="card-body">
              <p id="errorAlert" class="alert" style="display: none;"></p>
              <form id="addPaymentForm">
                <h6 class="heading-small text-muted mb-4">Payment Information</h6>
                <div class="pl-lg-4">
                  <div class="row">
                    <input type="hidden" id="customerId" value="<%= customer.id %>" disabled />
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-username">Name</label>
                        <input type="text" id="input-username" class="form-control" placeholder="Username"
                        value="<%= customer.firstName + ' ' + customer.lastName %> " disabled>
                      </div>
                    </div>
                    
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-email">Email address</label>
                        <input type="email" id="input-email" class="form-control" value="<%= customer.email %> "
                        disabled> </div>
                    </div>
                  </div>
                  <div class="row">
                    <input type="hidden" id="customerId" value="" disabled />
                    <div class="col-lg-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-first-name">Enter Payment</label>
                         
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">$</span>
                            </div>
                            <input type="text" id="moneyAmount" class="form-control"
                            value="<%= parseInt(customer.payments.totalAmount) - parseInt(customer.payments.recivedAmount) %>">
                            <div class="input-group-append">
                              <span class="input-group-text">.00</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    
                      <div class="col-lg-6">
                        <div class="form-group">
                          <label class="form-control-label" for="input-email">Company Name</label>
                          <select class="form-control" id="exampleFormControlSelect1">
                              <option>Ks Builders</option>
                              <option>Ks Paintings</option>
                            </select>
                        </div>
                      </div>
                  </div>
                  <div class="row">
                    <div class="col-lg-6">
                        <!-- <label class="form-control-label" for="input-first-name">Due Date</label><br>
                      <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
                            </div>
                            <input class="form-control datepicker" placeholder="Select date" type="text" required id="dueDateChart">
                        </div>
                      </div> -->
                    </div>
                    <div class="col-lg-3">
                        <label class="form-control-label" for="input-first-name">Send Email?</label><br>
                        <label class="custom-toggle">
                          <input id="customerEmailSwitch" type="checkbox" checked>
                          <span class="custom-toggle-slider rounded-circle"></span>
                        </label>
                      </div>
                      <div class="col-lg-3">
                        <label class="form-control-label" for="input-first-name">Include GST?</label><br>
                        <label class="custom-toggle">
                          <input id="customerGstSwitch" type="checkbox" checked>
                          <span class="custom-toggle-slider rounded-circle"></span>
                        </label>
                      </div>
                    <button type="submit" class="btn btn-sm btn-success">Done</a>
                   
                  </div>
                </div>
               
              </form>
            </div>
          </div>
        </div>
        <div class="col-xl-4">
          <div class="card">
            <div class="card-header border-0">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="mb-0">History</h3>
                </div>
                <div class="col text-right">
                  <a href="#!" class="btn btn-sm btn-primary">See all</a>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <!-- Projects table -->
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">Serial</th>
                    <th scope="col">Date</th>
                    <th scope="col">Payment</th>

                  </tr>
                </thead>
                <tbody>
                  <% transcations.forEach((trx, index) => { %>
                  <tr>
                    <td><%= index+1 %> </td>
                    <th scope="row">
                      <%= (new Date(trx.createdAt)).toLocaleDateString() %>
                    </th>
                    <td>
                      $<%= trx.amountRecived %>
                    </td>

                  </tr>
                  <% }) %>


                </tbody>
              </table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Argon Scripts -->
  <script>
    const form = document.getElementById('addPaymentForm');
    const alertBox = document.getElementById('errorAlert');
    const gstSwitch = document.getElementById('customerGstSwitch');

    alertBox.innerHTML = '';
    alertBox.style.display = 'none';

    const handleFormSubmit = async (e) => {
      e.preventDefault();

      const customerId = (document.getElementById('customerId').value).trim();
      const amount = parseInt(document.getElementById('moneyAmount').value);
      const email = document.getElementById('customerEmailSwitch').checked;
      const includeGst = gstSwitch.checked;

      const URL = '/api/customers/payments/make';
      const options = {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          customerId,
          amount,
          email,
          includeGst
        })
      };

      const response = await (await fetch(URL, options)).json();
      if (response.error) {
        alertBox.style.display = 'block';
        alertBox.classList.add('alert-danger');
        alertBox.innerText = response.error || 'Something went wrong';
      } else if (response.message === 'success') {
        window.location.reload()
      }

    }

    const handleGstSwitchChanged = (event) => {
      if (gstSwitch.checked) {
        document.getElementById('customerEmailSwitch').removeAttribute('disabled');
        document.getElementById('customerEmailSwitch').checked = true;
      } else {
        document.getElementById('customerEmailSwitch').checked = false;
        document.getElementById('customerEmailSwitch').setAttribute('disabled', true);
      }
    }

    form.addEventListener('submit', handleFormSubmit);
    gstSwitch.addEventListener('change', handleGstSwitchChanged);
  </script>
  <!-- Core -->
  <script src="assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/js-cookie/js.cookie.js"></script>
  <script src="assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
  <script src="assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
  <!-- Optional JS -->
  <script src="assets/vendor/chart.js/dist/Chart.min.js"></script>
  <script src="assets/vendor/chart.js/dist/Chart.extension.js"></script>
  <!-- Argon JS -->
  <script src="assets/js/argon.js?v=1.2.0"></script>
</body>

</html>